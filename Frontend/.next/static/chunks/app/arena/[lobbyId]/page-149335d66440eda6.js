(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[244],{395:(e,s,t)=>{Promise.resolve().then(t.bind(t,542))},542:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>V});var a=t(5155),r=t(9137),l=t.n(r),n=t(2115),o=t(5695),i=t(7168),c=t(8482),d=t(8145);let m=0,x=new Map,u=e=>{if(x.has(e))return;let s=setTimeout(()=>{x.delete(e),b({type:"REMOVE_TOAST",toastId:e})},1e6);x.set(e,s)},h=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?u(t):e.toasts.forEach(e=>{u(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},f=[],g={toasts:[]};function b(e){g=h(g,e),f.forEach(e=>{e(g)})}function p(e){let{...s}=e,t=(m=(m+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>b({type:"DISMISS_TOAST",toastId:t});return b({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>b({type:"UPDATE_TOAST",toast:{...e,id:t}})}}var j=t(501),y=t(1973),w=t(9955),N=t(1681),v=t(2741),A=t(5010),S=t(883),k=t(8242),C=t(7951),z=t(1539),_=t(8186),E=t(9946);let L=(0,E.A)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),T=(0,E.A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var I=t(7580),P=t(3550),D=t(4186);let F=(0,E.A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var R=t(646),M=t(1154),Q=t(6785);function q(e){let{currentQuestion:s,totalQuestions:t,playerScore:r,timeRemaining:l,questionDuration:n,playersFinished:o,totalPlayers:i,isLastQuestion:d=!1,questionSource:m=null}=e,x=Math.min(s+1,t),u=x/t*100,h=Math.max(0,Math.min(100,l/n*100)),f=l<=5,g=l<=2,b=g?"from-red-600 via-red-500 to-orange-500 animate-pulse":f?"from-rose-500 via-red-500 to-orange-500":"from-emerald-500 via-green-500 to-teal-500";return(0,a.jsx)("div",{className:"sticky top-20 z-40 w-full mb-6 px-4 animate-in slide-in-from-top-4 duration-500",children:(0,a.jsx)(c.Zp,{className:"border-0 shadow-2xl ".concat("bg-gradient-to-r from-white via-blue-50/40 to-purple-50/40"," backdrop-blur-xl hover:shadow-3xl transition-all duration-300"),style:{borderRadius:16},children:(0,a.jsxs)(c.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-blue-100",children:(0,a.jsx)(Q.A,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Question"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:[x,"/",t]})]})]}),(0,a.jsxs)("div",{className:"w-28",children:[(0,a.jsx)("div",{className:"h-2 w-full rounded-full bg-gray-200 overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-indigo-500 via-blue-500 to-cyan-500 transition-all",style:{width:"".concat(Math.min(100,Math.max(0,u)),"%")}})}),(0,a.jsxs)("div",{className:"text-xs text-center text-gray-600 mt-1 font-semibold",children:[Math.round(u),"%"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-8",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)(_.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Score"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:r.toLocaleString()})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 ".concat(g?"text-red-600 animate-pulse":f?"text-red-600":"text-orange-600")}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Time"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold transition-colors duration-300 ".concat(g?"text-red-600 animate-pulse":f?"text-red-600":"text-emerald-600"),children:[Math.max(0,l),"s"]}),g&&(0,a.jsx)("div",{className:"text-xs text-red-600 font-bold animate-bounce",children:"\uD83D\uDEA8 CRITICAL!"}),f&&!g&&(0,a.jsx)("div",{className:"text-xs text-red-600 font-medium animate-pulse",children:"⚠️ Hurry!"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)(I.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Players"})]}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:[o,"/",i]}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:o===i?"All done!":"playing"})]}),m&&(0,a.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-bold ".concat("ai"===m?"bg-gradient-to-r from-purple-500 to-indigo-500 text-white":"bg-gradient-to-r from-orange-500 to-red-500 text-white"),children:"ai"===m?"\uD83E\uDD16 AI Questions":"\uD83D\uDCDA Fallback"}),d&&(0,a.jsx)("div",{className:"px-3 py-1 bg-gradient-to-r from-fuchsia-500 to-pink-500 text-white rounded-full text-sm font-bold animate-pulse",children:"\uD83C\uDF89 Final Q!"})]})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsxs)("div",{className:"relative h-4 rounded-full overflow-hidden bg-gray-200 shadow-inner",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r ".concat(b," transition-all duration-500 ease-out"),style:{width:"".concat(Math.min(100,Math.max(0,h)),"%")}}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-[11px] font-bold transition-colors duration-300 ".concat(g?"text-white":f?"text-red-800":"text-gray-700"),children:[Math.round(h),"% time left"]})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[(0,a.jsxs)("span",{children:["Question ",x," of ",t]}),(0,a.jsxs)("span",{children:[Math.round(u),"% complete"]})]})]})]})})})}var O=t(5595),Z=t(9037),U=t(8564);let W=(0,E.A)("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]),G=(0,E.A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),B=(0,E.A)("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);function J(e){let{results:s,lobbyId:t,currentPlayerAddress:r,onPlayAgain:o,onBackToLobby:m}=e,[x,u]=(0,n.useState)(!1),[h,f]=(0,n.useState)(null),[g,b]=(0,n.useState)(!1),j=s.filter(e=>e.has_played).sort((e,s)=>s.score-e.score);(0,n.useEffect)(()=>{j.length>0&&(f(j[0]),b(r&&j[0].player_address.toLowerCase()===r.toLowerCase()),setTimeout(()=>{u(!0)},1e3))},[j,r]);let y=e=>0===e?(0,a.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center bg-gradient-to-br from-yellow-400 to-yellow-600 border-4 border-yellow-500 shadow-2xl shadow-yellow-500/50 animate-bounce",children:(0,a.jsx)(C.A,{className:"h-8 w-8 text-white"})}):1===e?(0,a.jsx)("div",{className:"w-14 h-14 rounded-full flex items-center justify-center bg-gradient-to-br from-gray-300 to-gray-500 border-4 border-gray-400 shadow-xl shadow-gray-500/50",children:(0,a.jsx)(O.A,{className:"h-7 w-7 text-white"})}):2===e?(0,a.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-br from-amber-400 to-amber-600 border-4 border-amber-500 shadow-lg shadow-amber-500/50",children:(0,a.jsx)(O.A,{className:"h-6 w-6 text-white"})}):(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-blue-400 to-blue-600 border-2 border-blue-500",children:(0,a.jsx)("span",{className:"text-white font-bold",children:e+1})}),w=e=>{let s=["\uD83C\uDFC6 Champion","\uD83E\uDD48 Runner-up","\uD83E\uDD49 Third Place","⭐ Player"];return s[Math.min(e,s.length-1)]},N=async()=>{let e="\uD83C\uDF89 Quiz Results for Lobby #".concat(t,":\n\n")+j.slice(0,3).map((e,s)=>"".concat(s+1,". ").concat(e.player_address.slice(0,6),"...").concat(e.player_address.slice(-4),": ").concat(e.score," points")).join("\n");try{await navigator.clipboard.writeText(e),p({title:"Success!",description:"Results copied to clipboard!"})}catch(e){p({title:"Error",description:"Failed to copy results",variant:"destructive"})}};return(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center p-4",children:[x&&g&&(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f fixed inset-0 pointer-events-none z-10",children:[(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f absolute inset-0 bg-gradient-to-r from-yellow-400/20 to-yellow-600/20 animate-pulse"}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f absolute top-1/4 left-1/4 text-6xl animate-bounce",children:"\uD83C\uDF89"}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f absolute top-1/3 right-1/4 text-4xl animate-bounce delay-100",children:"\uD83C\uDFC6"}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f absolute bottom-1/3 left-1/3 text-5xl animate-bounce delay-200",children:"⭐"}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f absolute bottom-1/4 right-1/3 text-4xl animate-bounce delay-300",children:"\uD83C\uDF8A"})]}),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f w-full max-w-4xl space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f text-center space-y-4",children:[(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f flex items-center justify-center gap-3",children:[(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f p-4 rounded-2xl bg-gradient-to-br from-yellow-400 to-yellow-600 shadow-2xl",children:(0,a.jsx)(_.A,{className:"h-12 w-12 text-white"})}),(0,a.jsx)("h1",{className:"jsx-169e2a3dca20af5f text-4xl font-bold bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent",children:"\uD83C\uDF89 Quiz Complete!"})]}),g&&(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f bg-gradient-to-r from-yellow-200 to-orange-200 border-2 border-yellow-400 rounded-2xl p-6 shadow-xl animate-pulse",children:(0,a.jsxs)("h2",{className:"jsx-169e2a3dca20af5f text-3xl font-bold text-gray-900 flex items-center justify-center gap-3",children:[(0,a.jsx)(C.A,{className:"h-8 w-8 text-yellow-600"}),"Congratulations! You're the Champion! \uD83C\uDFC6",(0,a.jsx)(C.A,{className:"h-8 w-8 text-yellow-600"})]})}),(0,a.jsxs)("p",{className:"jsx-169e2a3dca20af5f text-gray-600 text-lg",children:["Final Results for Lobby #",t]})]}),(0,a.jsxs)(c.Zp,{className:"border-0 shadow-2xl bg-white/95 backdrop-blur-sm",children:[(0,a.jsx)(c.aR,{className:"pb-4",children:(0,a.jsxs)(c.ZB,{className:"flex items-center justify-center gap-3 text-2xl",children:[(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f p-2 rounded-xl bg-gradient-to-br from-purple-500 to-blue-600",children:(0,a.jsx)(Z.A,{className:"h-6 w-6 text-white"})}),(0,a.jsx)("span",{className:"jsx-169e2a3dca20af5f bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent",children:"Final Leaderboard"})]})}),(0,a.jsx)(c.Wu,{className:"space-y-4",children:j.map((e,s)=>{let t=r&&e.player_address.toLowerCase()===r.toLowerCase();return(0,a.jsx)("div",{style:{animationDelay:"".concat(200*s,"ms"),animation:x?"slideInUp 0.6s ease-out forwards":"none"},className:"jsx-169e2a3dca20af5f "+"relative overflow-hidden rounded-2xl border-2 transition-all duration-500 ".concat(0===s?"bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-300 shadow-xl shadow-yellow-500/30 scale-105":1===s?"bg-gradient-to-r from-gray-50 to-gray-100 border-gray-300 shadow-lg shadow-gray-500/30":2===s?"bg-gradient-to-r from-amber-50 to-amber-100 border-amber-300 shadow-lg shadow-amber-500/30":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 hover:border-blue-300"," ").concat(t?"ring-4 ring-blue-400 ring-opacity-50":""),children:(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f flex items-center justify-between p-6",children:[(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f flex items-center gap-6",children:[y(s),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f space-y-2",children:[(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f flex items-center gap-3",children:[(0,a.jsx)("p",{className:"jsx-169e2a3dca20af5f "+"font-bold text-lg font-mono ".concat(t?"text-blue-700":"text-gray-900"),children:t?"You":"".concat(e.player_address.slice(0,6),"...").concat(e.player_address.slice(-4))}),t&&(0,a.jsxs)(d.E,{className:"bg-blue-500 text-white",children:[(0,a.jsx)(U.A,{className:"h-3 w-3 mr-1"}),"You"]}),(0,a.jsx)(d.E,{className:"".concat(0===s?"bg-yellow-500 text-white":1===s?"bg-gray-500 text-white":2===s?"bg-amber-600 text-white":"bg-blue-100 text-blue-700"),children:w(s)})]}),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f flex items-center gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("span",{className:"jsx-169e2a3dca20af5f flex items-center gap-1",children:[(0,a.jsx)(Q.A,{className:"h-4 w-4"}),e.correct_answers,"/",e.total_questions," correct"]}),e.time_bonus>0&&(0,a.jsxs)("span",{className:"jsx-169e2a3dca20af5f flex items-center gap-1 text-green-600",children:[(0,a.jsx)(z.A,{className:"h-4 w-4"}),"+",e.time_bonus," time bonus"]}),(0,a.jsxs)("span",{className:"jsx-169e2a3dca20af5f flex items-center gap-1",children:[(0,a.jsx)(W,{className:"h-4 w-4"}),Math.round(e.correct_answers/e.total_questions*100),"% accuracy"]})]})]})]}),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f text-right",children:[(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f flex items-center gap-3",children:[(0,a.jsx)("span",{className:"jsx-169e2a3dca20af5f "+"text-4xl font-bold ".concat(0===s?"text-yellow-600":1===s?"text-gray-600":2===s?"text-amber-600":"text-blue-600"),children:e.score.toLocaleString()}),0===s&&(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f animate-bounce",children:(0,a.jsx)(C.A,{className:"h-8 w-8 text-yellow-500"})})]}),(0,a.jsx)("p",{className:"jsx-169e2a3dca20af5f text-sm font-medium text-gray-500",children:"points"})]})]})},"final-".concat(e.player_address,"-").concat(s))})})]}),(0,a.jsx)(c.Zp,{className:"border-0 shadow-xl bg-white/95 backdrop-blur-sm",children:(0,a.jsx)(c.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f grid grid-cols-2 md:grid-cols-4 gap-6 text-center",children:[(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f space-y-2",children:[(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-3xl font-bold text-blue-600",children:j.length}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-sm text-gray-600",children:"Total Players"})]}),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f space-y-2",children:[(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-3xl font-bold text-green-600",children:Math.round(j.reduce((e,s)=>e+s.score,0)/j.length)}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-sm text-gray-600",children:"Average Score"})]}),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f space-y-2",children:[(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-3xl font-bold text-purple-600",children:j.reduce((e,s)=>e+s.correct_answers,0)}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-sm text-gray-600",children:"Total Correct"})]}),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f space-y-2",children:[(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-3xl font-bold text-orange-600",children:(null==h?void 0:h.score)||0}),(0,a.jsx)("div",{className:"jsx-169e2a3dca20af5f text-sm text-gray-600",children:"Highest Score"})]})]})})}),(0,a.jsxs)("div",{className:"jsx-169e2a3dca20af5f flex flex-col sm:flex-row gap-4 justify-center",children:[(0,a.jsxs)(i.$,{onClick:N,variant:"outline",size:"lg",className:"flex items-center gap-2 hover:bg-blue-50 border-blue-200",children:[(0,a.jsx)(G,{className:"h-5 w-5"}),"Copy Results"]}),(0,a.jsxs)(i.$,{onClick:()=>{let e="Just finished a QuizCraft game in Lobby #".concat(t,"! \uD83C\uDFAE"),s=window.location.origin,a="https://twitter.com/intent/tweet?text=".concat(encodeURIComponent(e),"&url=").concat(encodeURIComponent(s));window.open(a,"_blank")},variant:"outline",size:"lg",className:"flex items-center gap-2 hover:bg-blue-50 border-blue-200",children:[(0,a.jsx)(B,{className:"h-5 w-5"}),"Share on Twitter"]}),o&&(0,a.jsxs)(i.$,{onClick:o,size:"lg",className:"flex items-center gap-2 bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white",children:[(0,a.jsx)(z.A,{className:"h-5 w-5"}),"Play Again"]}),m&&(0,a.jsxs)(i.$,{onClick:m,variant:"outline",size:"lg",className:"flex items-center gap-2 hover:bg-gray-50",children:[(0,a.jsx)(I.A,{className:"h-5 w-5"}),"Back to Lobby"]})]})]}),(0,a.jsx)(l(),{id:"169e2a3dca20af5f",children:"@-webkit-keyframes slideInUp{from{opacity:0;-webkit-transform:translatey(30px);transform:translatey(30px)}to{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes slideInUp{from{opacity:0;-moz-transform:translatey(30px);transform:translatey(30px)}to{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes slideInUp{from{opacity:0;-o-transform:translatey(30px);transform:translatey(30px)}to{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes slideInUp{from{opacity:0;-webkit-transform:translatey(30px);-moz-transform:translatey(30px);-o-transform:translatey(30px);transform:translatey(30px)}to{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}"})]})}function $(e){let{lobbyId:s,players:t,category:r,onGameEnd:l,onScoreUpdate:o,questionDurationSec:m,seed:x,currentPlayerAddress:u}=e,[h,f]=(0,n.useState)("waiting"),[g,b]=(0,n.useState)(0),[p,j]=(0,n.useState)([]),[y,w]=(0,n.useState)(null),[N,v]=(0,n.useState)(!1),[A,S]=(0,n.useState)(!0),[k,C]=(0,n.useState)(m),[z,_]=(0,n.useState)({}),[E,T]=(0,n.useState)(!1),[P,F]=(0,n.useState)([]),[R,M]=(0,n.useState)(null),[O,Z]=(0,n.useState)(!1);(0,n.useEffect)(()=>{try{let e=sessionStorage.getItem("quizcraft:scores:".concat(s));if(e){let s=JSON.parse(e);console.log("SynchronizedQuizGame hydrating scores from sessionStorage:",s),_(s)}}catch(e){console.error("Error hydrating SynchronizedQuizGame scores:",e)}},[s]),(0,n.useEffect)(()=>{try{console.log("SynchronizedQuizGame persisting scores to sessionStorage:",z),sessionStorage.setItem("quizcraft:scores:".concat(s),JSON.stringify(z))}catch(e){console.error("Error persisting SynchronizedQuizGame scores:",e)}},[s,z]);let[U,W]=(0,n.useState)(null),[G,B]=(0,n.useState)(null),[$,X]=(0,n.useState)([]),[Y,V]=(0,n.useState)(null),[H,K]=(0,n.useState)(!1);(0,n.useEffect)(()=>{0===p.length&&et()},[]),(0,n.useEffect)(()=>{"playing"===h&&p.length>0&&U&&ee(U)},[h,p.length,U]),(0,n.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/game-sync?lobbyId=".concat(s)),t=await e.json();t.success?(W(t.gameStartTime),B(t.countdown),t.hasStarted?(f("playing"),ee(t.gameStartTime)):t.countdown>0&&(f("countdown"),es(t.countdown))):f("waiting")}catch(e){console.error("Sync error:",e),V("Failed to sync with game server")}};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[s]);let ee=(0,n.useCallback)(e=>{if(0===p.length)return;Z(!0);let s=Date.now()-e,t=Math.floor(s/(1e3*m)),a=s%(1e3*m),r=Math.max(0,m-Math.floor(a/1e3)),l=Math.min(t,p.length-1);if(t>=p.length){ea();return}b(l),C(r);let n=l,o=setInterval(()=>{let s=Date.now()-e,t=Math.floor(s/(1e3*m)),a=s%(1e3*m),r=Math.max(0,m-Math.floor(a/1e3)),l=Math.min(t,p.length-1);if(t>=p.length){clearInterval(o),ea();return}l!==n&&(console.log("SynchronizedQuizGame question changed from ".concat(n," to ").concat(l,", resetting selection")),n=l,b(l),w(null),v(!1),S(!0),T(!1)),C(r)},100);return()=>clearInterval(o)},[p.length,m,p]),es=(0,n.useCallback)(e=>{let s=e;B(s);let t=setInterval(()=>{B(s-=1),s<=0&&(clearInterval(t),f("playing"),ee(U))},1e3)},[U,ee]);(0,n.useEffect)(()=>{let e=setInterval(async()=>{if("playing"===h)try{let e=await fetch("/api/scores/all-players?lobbyId=".concat(s));if(e.ok){let s=await e.json();if(s.players){let e=s.players.map(e=>({address:e.player_address,score:e.score,currentQuestion:g,isConnected:!0}));X(e)}}}catch(e){console.error("Error updating live scores:",e)}},2e3);return()=>clearInterval(e)},[s,h,g]);let et=async()=>{try{let s=await fetch("/api/generate-quiz",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:r||"Technology",difficulty:"medium",questionCount:10,timePerQuestion:m,seed:x})}),t=await s.json();if(t.success){var e;j(t.quiz.questions),C(m);let s=!!(null===(e=t.debug)||void 0===e?void 0:e.fallbackUsed);M(s?"fallback":"ai")}else{let e={id:"placeholder",question:"Placeholder question: Which letter comes first?",options:["A","B","C","D"],correctAnswer:0,timeLimit:m,explanation:'The correct answer is "A".',category:r||"General",difficulty:"easy"};j([e]),C(e.timeLimit),M("fallback")}}catch(e){console.error("Error generating quiz:",e)}},ea=async()=>{if(H){console.log("Synchronized scores already submitted, skipping duplicate submission");return}f("finished"),Z(!1),K(!0);let e=0;try{let t=sessionStorage.getItem("quizcraft:scores:".concat(s));if(t){let s=JSON.parse(t);for(let[t,a]of Object.entries(s))if(t.toLowerCase()===u.toLowerCase()){e=Number(a);break}}}catch(e){console.error("Error getting sessionStorage scores:",e)}0===e&&(e=z[u]||0),console.log("SynchronizedQuizGame final score:",e,"from playerScores:",z[u]);let a=Math.floor(e/100),n=e%100,o=t.map(s=>{if(s.toLowerCase()===u.toLowerCase())return{player:s,score:e,correctAnswers:a,totalQuestions:p.length,timeBonus:n};{let e=$.find(e=>e.address.toLowerCase()===s.toLowerCase()),t=(null==e?void 0:e.score)||0;return{player:s,score:t,correctAnswers:Math.floor(t/100),totalQuestions:p.length,timeBonus:t%100}}});F(o),l(o);let i={lobbyId:s,players:t,scores:t.map(e=>{let s=o.find(s=>s.player.toLowerCase()===e.toLowerCase());return(null==s?void 0:s.score)||0}),detailedResults:o,timestamp:Date.now(),status:"completed",totalQuestions:p.length,category:r||"Technology",currentPlayerAddress:u,currentPlayerScore:e,synchronized:!0};localStorage.setItem("quizcraft:lobby-scores:".concat(s),JSON.stringify(i)),sessionStorage.setItem("quizcraft:local-scores:".concat(s),JSON.stringify(i));try{let t={player_address:u,score:e,correct_answers:a,total_questions:p.length,time_bonus:n};console.log("Submitting synchronized game score to Supabase:",t),await fetch("/api/scores/upsert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lobbyId:Number(s),results:[t]})}),console.log("Synchronized game score submitted successfully to Supabase")}catch(e){console.error("Failed to submit synchronized game score to Supabase:",e)}console.log("Synchronized game results stored:",i)},er=e=>{if(console.log("SynchronizedQuizGame handleAnswerSelect: answerIndex=".concat(e,", selectedAnswer=").concat(y,", gameState=").concat(h,", currentQuestion=").concat(g)),null!==y||N||"playing"!==h){console.log("SynchronizedQuizGame answer selection blocked: selectedAnswer=".concat(y,", isAnswered=").concat(N,", gameState=").concat(h));return}let s=p[g];if(!s)return;w(s=>null!==s?(console.log("SynchronizedQuizGame selection already exists: ".concat(s,", ignoring new selection: ").concat(e)),s):(console.log("SynchronizedQuizGame setting selection to: ".concat(e)),e)),v(!0),S(!1),T(!0);let t=e===s.correctAnswer,a=Math.floor(2*k),r=t?100+a:-25;console.log("SynchronizedQuizGame score update: correct=".concat(t,", timeBonus=").concat(a,", points=").concat(r,", timeLeft=").concat(k)),_(e=>{let s=e[u]||0,t=Math.max(0,s+r),a={...e,[u]:t};return console.log("SynchronizedQuizGame scores updated: ".concat(s," + ").concat(r," = ").concat(t),a),o&&o(a),a})};if((0,n.useEffect)(()=>{if(O){let e=e=>(e.preventDefault(),e.returnValue="Are you sure you want to leave? Your progress will be lost!","Are you sure you want to leave? Your progress will be lost!"),s=e=>{e.preventDefault(),window.history.pushState(null,"",window.location.href)};return window.addEventListener("beforeunload",e),window.addEventListener("popstate",s),window.history.pushState(null,"",window.location.href),()=>{window.removeEventListener("beforeunload",e),window.removeEventListener("popstate",s)}}},[O]),"waiting"===h)return(0,a.jsx)(c.Zp,{className:"mb-8",children:(0,a.jsx)(c.Wu,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto",children:(0,a.jsx)(D.A,{className:"h-8 w-8 text-blue-600"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-blue-600",children:"Waiting for Game Start"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"The quiz will begin when all players are ready and synchronized."}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(I.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[t.length," players connected"]})]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-4 p-2 bg-gray-100 rounded",children:["Debug: gameState=",h,", questions.length=",p.length,", gameStartTime=",U,", countdown=",G]})]})})});if("countdown"===h)return(0,a.jsx)(c.Zp,{className:"mb-8",children:(0,a.jsx)(c.Wu,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"text-8xl font-bold text-green-600 mb-4 animate-pulse",children:G}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:"Get Ready!"}),(0,a.jsx)("p",{className:"text-xl text-muted-foreground",children:"The synchronized quiz battle is about to begin!"}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-4 text-sm text-muted-foreground",children:[(0,a.jsx)(I.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[t.length," players ready"]}),(0,a.jsx)(Q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"All questions start together"})]})]})})});if("finished"===h){let e=P.map(e=>({player_address:e.player,score:e.score,correct_answers:e.correctAnswers,total_questions:e.totalQuestions,time_bonus:e.timeBonus,has_played:!0}));return(0,a.jsx)(J,{results:e,lobbyId:s,currentPlayerAddress:u})}if("playing"===h&&p.length>0){let e=p[g];return e?(0,a.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[O&&(0,a.jsx)(c.Zp,{className:"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950",children:(0,a.jsx)(c.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 text-green-700 dark:text-green-300",children:[(0,a.jsx)(L,{className:"h-5 w-5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium",children:"Synchronized Quiz Active"}),(0,a.jsx)("p",{className:"text-sm opacity-80",children:"All players are answering the same questions at the same time!"})]})]})})}),(0,a.jsx)(q,{currentQuestion:g,totalQuestions:p.length,playerScore:z[u]||0,timeRemaining:k,questionDuration:m,playersFinished:$.length,totalPlayers:t.length,isLastQuestion:g===p.length-1,questionSource:R}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(c.ZB,{className:"text-xl",children:[e.category," - ",e.difficulty]}),(0,a.jsxs)(d.E,{variant:"outline",className:"bg-green-100 text-green-800",children:[(0,a.jsx)(Q.A,{className:"h-3 w-3 mr-1"}),"Question ",g+1]})]})}),(0,a.jsxs)(c.Wu,{className:"space-y-6",children:[(0,a.jsx)("p",{className:"text-lg font-medium",children:e.question}),(0,a.jsx)("div",{className:"grid gap-3",children:e.options.map((s,t)=>(0,a.jsxs)(i.$,{variant:y===t?"default":"outline",className:"p-4 h-auto text-left justify-start ".concat(null!==y&&t===e.correctAnswer?"bg-green-500 hover:bg-green-600 text-white":y===t&&y!==e.correctAnswer?"bg-red-500 hover:bg-red-600 text-white":null!==y?"opacity-50":"hover:bg-blue-50"),onClick:()=>er(t),disabled:null!==y||N||"playing"!==h,children:[(0,a.jsxs)("span",{className:"font-medium mr-3",children:[String.fromCharCode(65+t),"."]}),s]},t))}),E&&(0,a.jsx)("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Explanation:"})," ",e.explanation]})}),N&&(0,a.jsxs)("div",{className:"mt-4 text-center p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,a.jsx)("p",{className:"text-blue-800 font-medium",children:g<p.length-1?"Waiting for next question... (".concat(g+1,"/").concat(p.length,")"):"Final question completed! (".concat(g+1,"/").concat(p.length,")")}),(0,a.jsx)("p",{className:"text-sm text-blue-600 mt-1",children:"All players will advance together automatically"})]})]})]}),Y&&(0,a.jsx)(c.Zp,{className:"border-red-200 bg-red-50",children:(0,a.jsx)(c.Wu,{className:"p-4",children:(0,a.jsx)("p",{className:"text-red-800 text-sm",children:Y})})})]}):(0,a.jsx)(c.Zp,{className:"mb-8",children:(0,a.jsx)(c.Wu,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"text-lg text-muted-foreground",children:["Loading question ",g+1,"..."]})})})}return(0,a.jsx)(c.Zp,{className:"mb-8",children:(0,a.jsx)(c.Wu,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"text-lg text-muted-foreground",children:"Preparing synchronized quiz..."})})})}var X=t(3904);function Y(e){let{lobbyId:s,refreshInterval:t=5e3,gameState:r="waiting",currentPlayerAddress:l}=e,[o,m]=(0,n.useState)([]),[x,u]=(0,n.useState)(!0),[h,f]=(0,n.useState)(null),[g,b]=(0,n.useState)(null);if(!s||"undefined"===s||"null"===s)return(0,a.jsx)(c.Zp,{className:"mb-8 border-0 shadow-xl bg-gradient-to-br from-white via-red-50/30 to-red-50/30 backdrop-blur-sm",children:(0,a.jsxs)(c.Wu,{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(_.A,{className:"h-8 w-8 text-red-500"})}),(0,a.jsx)("p",{className:"text-red-600 font-medium",children:"Invalid lobby ID. Please check the URL."})]})});let p=async()=>{try{if(u(!0),!s||"undefined"===s||"null"===s)throw Error("Invalid lobby ID");console.log("Fetching scores for lobbyId:",s);let e=await fetch("/api/scores/all-players?lobbyId=".concat(s));if(!e.ok){let s;console.error("Response not OK:",{status:e.status,statusText:e.statusText,url:e.url});try{s=await e.json(),console.error("API Error Data:",s)}catch(t){console.error("Failed to parse error response as JSON:",t),s={error:"HTTP ".concat(e.status,": ").concat(e.statusText)}}throw Error(s.error||"HTTP ".concat(e.status,": ").concat(e.statusText))}let t=await e.json();console.log("Fetched scores data:",t),console.log("Debug info:",t.debug),m(t.players||[]),b(new Date),f(null)}catch(e){console.error("Error fetching real-time scores:",e),f(e.message||"Failed to fetch scores")}finally{u(!1)}};(0,n.useEffect)(()=>{p();let e=setInterval(p,t);return()=>clearInterval(e)},[s,t]);let j=(e,s)=>s?0===e?(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-yellow-400 to-yellow-600 border-2 border-yellow-500 shadow-lg shadow-yellow-500/30",children:(0,a.jsx)(C.A,{className:"h-5 w-5 text-white"})}):1===e?(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-gray-300 to-gray-500 border-2 border-gray-400 shadow-lg shadow-gray-500/30",children:(0,a.jsx)(O.A,{className:"h-5 w-5 text-white"})}):2===e?(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-amber-400 to-amber-600 border-2 border-amber-500 shadow-lg shadow-amber-500/30",children:(0,a.jsx)(O.A,{className:"h-5 w-5 text-white"})}):(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-blue-400 to-blue-600 border-2 border-blue-500 shadow-md",children:(0,a.jsx)("span",{className:"text-white font-bold text-sm",children:e+1})}):(0,a.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200 border-2 border-gray-300 animate-pulse",children:(0,a.jsx)(z.A,{className:"h-5 w-5 text-gray-500"})}),y=(e,s)=>s?0===e?(0,a.jsxs)(d.E,{className:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white border-0 shadow-lg",children:[(0,a.jsx)(C.A,{className:"h-3 w-3 mr-1"}),"Champion"]}):1===e?(0,a.jsxs)(d.E,{className:"bg-gradient-to-r from-gray-400 to-gray-600 text-white border-0 shadow-lg",children:[(0,a.jsx)(O.A,{className:"h-3 w-3 mr-1"}),"Runner-up"]}):2===e?(0,a.jsxs)(d.E,{className:"bg-gradient-to-r from-amber-500 to-amber-700 text-white border-0 shadow-lg",children:[(0,a.jsx)(O.A,{className:"h-3 w-3 mr-1"}),"Third Place"]}):(0,a.jsxs)(d.E,{variant:"secondary",className:"bg-blue-50 text-blue-700 border-blue-200",children:[(0,a.jsx)(U.A,{className:"h-3 w-3 mr-1"}),"Player"]}):(0,a.jsxs)(d.E,{variant:"outline",className:"bg-gray-50 border-gray-200 text-gray-600",children:[(0,a.jsx)(Q.A,{className:"h-3 w-3 mr-1"}),"Waiting"]});return(0,a.jsxs)(c.Zp,{className:"mb-8 border-0 shadow-xl bg-gradient-to-br from-white via-blue-50/30 to-purple-50/30 backdrop-blur-sm",children:[(0,a.jsx)(c.aR,{className:"pb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)(c.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,a.jsx)("div",{className:"p-2 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg",children:(0,a.jsx)(_.A,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"waiting"===r?"Lobby Players":"playing"===r?"Live Scores":"Final Results"}),(0,a.jsx)("div",{className:"text-sm text-gray-600 font-normal",children:"waiting"===r?"Players waiting to start the game":"playing"===r?"Live on-chain scores during quiz":"Final scores and rankings"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(I.A,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[o.length," players"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(z.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"finished"===r?"Final scores":"Real-time updates"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[g&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Last updated"}),(0,a.jsx)("div",{className:"text-xs font-medium",children:g.toLocaleTimeString()})]}),(0,a.jsxs)(i.$,{onClick:p,variant:"outline",size:"sm",className:"flex items-center gap-2 hover:bg-blue-50 border-blue-200 hover:border-blue-300 transition-all duration-200",disabled:x,children:[x?(0,a.jsx)(X.A,{className:"h-4 w-4 animate-spin text-blue-500"}):(0,a.jsx)(X.A,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)("span",{className:"text-blue-600 font-medium",children:"Refresh"})]})]})]})}),(0,a.jsx)(c.Wu,{className:"pt-0",children:h?(0,a.jsxs)("div",{className:"p-8 text-center bg-red-50 border border-red-200 rounded-xl",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(_.A,{className:"h-8 w-8 text-red-500"})}),(0,a.jsx)("p",{className:"text-red-600 font-medium mb-4",children:h}),(0,a.jsx)(i.$,{onClick:p,variant:"outline",size:"sm",className:"bg-red-50 border-red-200 text-red-600 hover:bg-red-100",children:"Try Again"})]}):x&&0===o.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse",children:(0,a.jsx)(X.A,{className:"h-10 w-10 animate-spin text-blue-500"})}),(0,a.jsx)("p",{className:"text-muted-foreground font-medium",children:"Loading leaderboard..."})]}):0===o.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(I.A,{className:"h-10 w-10 text-gray-400"})}),(0,a.jsx)("p",{className:"text-muted-foreground font-medium",children:"No players found in this lobby."})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[o.slice().sort((e,s)=>e.has_played!==s.has_played?s.has_played?1:-1:s.score-e.score).map((e,s)=>{let t=o.filter(e=>e.has_played).findIndex(s=>s.player_address===e.player_address),r=e.has_played&&t>=0&&t<3,n=l&&e.player_address.toLowerCase()===l.toLowerCase();return(0,a.jsxs)("div",{className:"group relative overflow-hidden rounded-2xl border-2 transition-all duration-300 hover:scale-[1.02] hover:shadow-lg ".concat(n?"bg-gradient-to-r from-green-50 to-emerald-50 border-green-300 ring-2 ring-green-400 ring-opacity-50 shadow-lg shadow-green-500/20":r&&0===t?"bg-gradient-to-r from-yellow-50 to-yellow-100 border-yellow-300 shadow-lg shadow-yellow-500/20":r&&1===t?"bg-gradient-to-r from-gray-50 to-gray-100 border-gray-300 shadow-lg shadow-gray-500/20":r&&2===t?"bg-gradient-to-r from-amber-50 to-amber-100 border-amber-300 shadow-lg shadow-amber-500/20":e.has_played?"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 hover:border-blue-300":"bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200 hover:border-gray-300"),children:[(0,a.jsx)("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity duration-300 ".concat(r&&0===t?"bg-gradient-to-r from-yellow-400 to-yellow-600":r&&1===t?"bg-gradient-to-r from-gray-400 to-gray-600":r&&2===t?"bg-gradient-to-r from-amber-400 to-amber-600":"bg-gradient-to-r from-blue-400 to-indigo-600")}),(0,a.jsxs)("div",{className:"relative flex items-center justify-between p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[j(t,e.has_played),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 font-mono",children:n?"You":"".concat(e.player_address.slice(0,6),"...").concat(e.player_address.slice(-4))}),n&&(0,a.jsxs)(d.E,{className:"bg-green-500 text-white border-0 shadow-lg",children:[(0,a.jsx)(U.A,{className:"h-3 w-3 mr-1"}),"You"]}),!n&&y(t,e.has_played)]}),e.has_played&&(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)(Q.A,{className:"h-3 w-3"}),e.correct_answers,"/",e.total_questions," correct"]}),e.time_bonus>0&&(0,a.jsxs)("span",{className:"flex items-center gap-1 text-green-600",children:[(0,a.jsx)(z.A,{className:"h-3 w-3"}),"+",e.time_bonus," time bonus"]})]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-3xl font-bold ".concat(r&&0===t?"text-yellow-600":r&&1===t?"text-gray-600":r&&2===t?"text-amber-600":e.has_played?"text-blue-600":"text-gray-500"),children:e.score.toLocaleString()}),r&&0===t&&(0,a.jsx)("div",{className:"animate-bounce",children:(0,a.jsx)(C.A,{className:"h-6 w-6 text-yellow-500"})})]}),(0,a.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"points"})]})]})]},"realtime-".concat(e.player_address,"-").concat(s))}),o.length>0&&(0,a.jsx)("div",{className:"mt-6 p-4 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl border border-gray-200",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:o.length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Players"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:o.filter(e=>e.has_played).length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Completed"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:o.filter(e=>!e.has_played).length}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Waiting"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:o.length>0?Math.round(o.reduce((e,s)=>e+s.score,0)/o.length):0}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Avg Score"})]})]})})]})})]})}function V(){var e,s;let t=(0,o.useParams)(),r=(0,o.useRouter)(),{toast:m}=function(){let[e,s]=n.useState(g);return n.useEffect(()=>(f.push(s),()=>{let e=f.indexOf(s);e>-1&&f.splice(e,1)}),[e]),{...e,toast:p,dismiss:e=>b({type:"DISMISS_TOAST",toastId:e})}}(),{signer:x,isConnected:u,isOnConflux:h,account:E}=(0,j.$)(),[Q,q]=(0,n.useState)(null),[O,Z]=(0,n.useState)(!0),[U,W]=(0,n.useState)([]),[G,B]=(0,n.useState)(!1),[J,X]=(0,n.useState)(!1),[V,H]=(0,n.useState)([]),[K,ee]=(0,n.useState)(null),[es,et]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(null),[el,en]=(0,n.useState)(null),[eo,ei]=(0,n.useState)(null),[ec,ed]=(0,n.useState)(null),[em,ex]=(0,n.useState)(!1),[eu,eh]=(0,n.useState)(null),[ef,eg]=(0,n.useState)(!1),[eb,ep]=(0,n.useState)(!1),[ej,ey]=(0,n.useState)([]),[ew,eN]=(0,n.useState)([]),[ev,eA]=(0,n.useState)(!1),[eS,ek]=(0,n.useState)(null),[eC,ez]=(0,n.useState)(null),[e_,eE]=(0,n.useState)(!1),[eL,eT]=(0,n.useState)(null),eI=t.lobbyId,eP=Number(eI),[eD,eF]=(0,n.useState)(!1),eR=G||es||3===eS,eM=!G&&(es||3===eS),eQ=es||3===eS;(0,n.useEffect)(()=>{try{let e=sessionStorage.getItem("quizcraft:finished:".concat(eI));"true"===e&&(ex(!0),X(!1))}catch(e){}},[eI]),(0,n.useEffect)(()=>{try{if(E){let e=sessionStorage.getItem("quizcraft:joined:".concat(eI,":").concat(E.toLowerCase()));eF("true"===e)}else eF(!1)}catch(e){eF(!1)}},[E,eI]);let eq=async()=>{console.log("Lobby page loaded for lobbyId:",eI),console.log("isConnected:",u,"isOnConflux:",h,"account:",E);try{let e=window.ethereum,s=e?new y.k(window.ethereum):null,t=new w.FR(S.qQ.rpcUrl),a=e&&h?s:t,r=new N.NZ(A.QX.QUIZ_CRAFT_ARENA,A.UN,a),l=await r.lobbies(eP);console.log("Raw lobby data from contract:",l);let n=l[11],o=l[10];console.log("Creator address (index 11):",n),console.log("Winner address (index 10):",o);let i=v.ck(l.entryFee),c=Number(l.status);ek(c);let d=Number(l.playerCount),m=Number(l.maxPlayers),x="";0===c?x=0===d?"Waiting for players":"".concat(d,"/").concat(m," players"):1===c?x=em?"Game Completed":J?"Game in progress":d>=m?"All players joined - Game starting soon":"".concat(d,"/").concat(m," players - Waiting for more players"):2===c?x="Game in progress":3===c?x="Completed":4===c&&(x="Cancelled");let u=await r.getPlayersInLobby(eP),f=!1;if(E){try{f=await r.isPlayerInLobby(eP,E),console.log("Contract membership check (primary):",f)}catch(e){console.error("Contract membership check (primary) failed:",e)}if(!f)try{let e=new N.NZ(A.QX.QUIZ_CRAFT_ARENA,A.UN,a===t&&s?s:t);f=await e.isPlayerInLobby(eP,E),console.log("Contract membership check (secondary):",f)}catch(e){console.error("Contract membership check (secondary) failed:",e)}if(!f){let e=E.toLowerCase();f=u.some(s=>s.toLowerCase()===e),console.log("Players list fallback check:",f)}try{f&&sessionStorage.setItem("quizcraft:joined:".concat(eI,":").concat(E.toLowerCase()),"true")}catch(e){}!f&&eD&&(f=!0,console.log("Session hint fallback:",f)),console.log("Final membership result:",{lobbyId:eP,account:E,userInLobby:f})}let g={id:String(l.id),name:l.name,category:l.category,mode:"\uD83C\uDFAF ".concat(l.name),entryFee:i,currentPlayers:d,maxPlayers:m,isActive:0===c&&d<m,creator:n,status:x,isUserInLobby:f};q(g),W(u),B(f);let b=1===l.distribution;console.log("Contract distribution status:",l.distribution,"isDistributed:",b),ez(b);try{let e=l.createdAt,s=await r.LOBBY_TIMEOUT(),t=Math.floor(Date.now()/1e3),a=Number(e+s),n=Math.max(0,a-t);ee(n),et(0===n),en(Number(e)),ei(a),ed(Number(s))}catch(e){}if(3===c){ex(!0),X(!1);try{let e=await fetch("/api/scores/all-players?lobbyId=".concat(eI));if(e.ok){let s=await e.json();if(s.players&&s.players.length>0){let e=s.players.filter(e=>e.has_played);if(e.length>0){let s=e.reduce((e,s)=>e.score>s.score?e:s);eh(s.player_address),console.log("Winner determined from Supabase scores:",s.player_address,"with score:",s.score)}}}}catch(e){console.error("Error fetching winner from Supabase:",e),eh(l.winner)}}}catch(e){console.error("Error fetching lobby details:",e)}finally{Z(!1)}};(0,n.useEffect)(()=>{eq()},[eI,u,h,E,eD]),(0,n.useEffect)(()=>{(async()=>{if(eM&&!(V.length>0))try{let e=window.ethereum,s=e?new y.k(window.ethereum):null,t=new w.FR(S.qQ.rpcUrl),a=e&&h?s:t,r=new N.NZ(A.QX.QUIZ_CRAFT_ARENA,A.UN,a);try{let[e,s,t]=await r.getLobbyResult(eP);console.log("Smart contract results:",{contractStatus:e,contractWinner:s,contractPrizePool:t}),s&&"0x0000000000000000000000000000000000000000"!==s&&eh(s),void 0!==e&&ek(Number(e))}catch(e){console.log("getLobbyResult not available yet or error:",e)}let l=await fetch("/api/scores/all-players?lobbyId=".concat(eI));if(l.ok){let e=await l.json();if(e.players&&e.players.length>0){let s=e.players.map(e=>({player:e.player_address,score:e.score||0,correctAnswers:e.correct_answers||0,totalQuestions:e.total_questions||10,timeBonus:0}));if(H(s),!eu&&s.length>0){let e=s.reduce((e,s)=>e.score>s.score?e:s);eh(e.player)}}}}catch(e){console.error("Error fetching results for viewing:",e)}})()},[eM,eI,V.length,eu,eP,h]),(0,n.useEffect)(()=>{let e=null;return(async()=>{try{if(!window.ethereum)return;let s=new y.k(window.ethereum);(e=new N.NZ(A.QX.QUIZ_CRAFT_ARENA,A.UN,s)).on("PlayerJoined",(e,s)=>{Number(e)===eP&&(console.log("Player joined this lobby:",s),m({title:"\uD83D\uDC64 Player Joined!",description:"".concat(s.slice(0,6),"...").concat(s.slice(-4)," joined the lobby."),duration:3e3}),setTimeout(()=>{eq()},1e3))})}catch(e){}})(),()=>{try{var s;null==e||null===(s=e.removeAllListeners)||void 0===s||s.call(e,"PlayerJoined")}catch(e){}}},[eP,m]),(0,n.useEffect)(()=>{if(null===K)return;if(K<=0){if(Q&&U.length>=Q.maxPlayers&&!J&&!em){console.log("Lobby would expire but all players are present, keeping lobby active");return}et(!0);return}let e=setTimeout(()=>ee(e=>e?e-1:0),1e3);return()=>clearTimeout(e)},[K,Q,U.length,J,em]),(0,n.useEffect)(()=>{if(null===eL)return;if(eL<=0){console.log("Game countdown reached 0, starting game..."),X(!0),eT(null),m({title:"\uD83C\uDFAE Game Started!",description:"The quiz battle has begun! Good luck!",duration:3e3});return}let e=setTimeout(()=>eT(e=>e?e-1:0),1e3);return()=>clearTimeout(e)},[eL,m]),(0,n.useEffect)(()=>{if(Q&&U.length>=Q.maxPlayers&&!J&&!eL&&!em){if(console.log("All players joined, triggering game start logic..."),"COMPLETED"!==Q.status)try{sessionStorage.removeItem("quizcraft:finished:".concat(eI)),ex(!1),console.log("Cleared previous game finished state for fresh start")}catch(e){console.error("Error clearing finished state:",e)}console.log("All players joined, starting synchronized game"),eO()}},[Q,U.length,J,eL,m,eI]);let eO=async()=>{try{let e=await fetch("/api/game-sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lobbyId:eI,action:"start_game"})}),s=await e.json();s.success?(console.log("Synchronized game started:",s),X(!0)):console.error("Failed to start synchronized game:",s)}catch(e){console.error("Error starting synchronized game:",e)}};(0,n.useEffect)(()=>{if(J||em)return;let e=setInterval(()=>{eq()},2e3);return()=>clearInterval(e)},[J,em]);let eZ=async()=>{if(x&&(null==Q?void 0:Q.creator)&&Q.creator.toLowerCase()===(null==E?void 0:E.toLowerCase())){eE(!0),m({title:"⏳ Resolving Prize...",description:"Processing prize distribution on-chain. Please wait.",duration:3e3});try{let e=null;try{let s=await fetch("/api/scores/all-players?lobbyId=".concat(eI));if(s.ok){let t=await s.json();if(t.players&&t.players.length>0){let s=t.players.filter(e=>e.has_played);if(s.length>0){let t=s.reduce((e,s)=>e.score>s.score?e:s);e=t.player_address,console.log("Winner for prize resolution determined from Supabase scores:",t.player_address,"with score:",t.score)}}}}catch(e){console.error("Error fetching winner from Supabase:",e)}if(e||(e=eu,console.log("Using fallback winner from state:",e)),!e){m({title:"❌ Cannot Resolve Prize",description:"Could not determine winner. Please try again.",variant:"destructive",duration:5e3});return}let s=new N.NZ(A.QX.QUIZ_CRAFT_ARENA,A.UN,x),t=await s.executeWinnerPayout(eP,e);console.log("executeWinnerPayout transaction sent:",t.hash);let r=await t.wait();console.log("Prize payout transaction confirmed:",r),m({title:"\uD83C\uDFC6 Prize Resolved Successfully!",description:"The winner has received the prize pool!",duration:6e3,action:(0,a.jsx)("a",{href:"https://evmtestnet.confluxscan.org/tx/".concat(t.hash),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline text-sm",children:"View Transaction"})}),console.log("Setting prizeDistributedOnChain to true after successful distribution"),ez(!0),setTimeout(()=>{eq()},2e3)}catch(e){console.error("resolvePrizeAsCreator error",e),m({title:"❌ Prize Resolution Failed",description:(null==e?void 0:e.message)||"Failed to resolve prize. Please try again.",variant:"destructive",duration:5e3})}finally{eE(!1)}}};(0,n.useEffect)(()=>{(async()=>{try{if(!h)return;let e=new y.k(window.ethereum),s=new N.NZ(A.QX.QUIZ_CRAFT_ARENA,A.UN,e),t=await s.leaderboardSet(eP);if(eA(t),console.log("Leaderboard set on-chain:",t),t){let e=await s.lobbyLeaderboard(eP,0);eN(e),console.log("On-chain leaderboard:",e)}let a=await s.getPlayersInLobby(eP),r=[];for(let e of a){let t=await s.playerScores(eP,e);r.push(t)}let l=a.map((e,s)=>({address:e,score:Number(r[s])}));ey(l),console.log("On-chain scores:",l);try{let e=localStorage.getItem("quizcraft:lobby-scores:".concat(eI));if(e){let s=JSON.parse(e);if(console.log("Local scores found:",s),0===l.length&&s.scores&&s.scores.length>0){let e=s.players.map((e,t)=>({address:e,score:Number(s.scores[t])}));ey(e),console.log("Using local scores as fallback:",e)}}}catch(e){console.error("Error reading local scores:",e)}}catch(e){console.error("Error fetching contract data:",e)}})()},[eI,h,em,J]);let eU=e=>{if(null===e)return"Unknown";switch(e){case 0:return"OPEN";case 1:return"FULL";case 2:return"IN_PROGRESS";case 3:return"COMPLETED";case 4:return"CANCELLED";default:return"Unknown"}},eW=(e,s)=>{let t=Math.max(0,Math.abs(e-Math.floor(Date.now()/1e3))),a=Math.floor(t/60),r=t%60;return a>0?s?"in ".concat(a,"m ").concat(r,"s"):"".concat(a,"m ").concat(r,"s ago"):s?"in ".concat(r,"s"):"".concat(r,"s ago")};return O?(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf max-w-4xl mx-auto space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf relative overflow-hidden rounded-xl border border-muted/30 bg-gradient-to-r from-muted/40 via-muted/60 to-muted/40",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/20 to-transparent animate-[shimmer_1.6s_infinite]"}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf p-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf space-y-2",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-6 w-40 bg-white/20 rounded"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-4 w-64 bg-white/10 rounded"})]}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf flex items-center gap-3",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-10 w-10 rounded-lg bg-white/20"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-10 w-28 rounded-lg bg-white/20"})]})]})]}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf grid grid-cols-1 md:grid-cols-3 gap-6",children:[0,1,2].map(e=>(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf relative overflow-hidden rounded-xl border border-muted/30 bg-card p-5",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/10 to-transparent animate-[shimmer_1.6s_infinite]"}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf flex items-center gap-3",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-10 w-10 rounded-lg bg-muted"}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf space-y-2 w-full",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-3 w-24 bg-muted rounded"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-4 w-32 bg-muted rounded"})]})]})]},e))}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf relative overflow-hidden rounded-xl border border-muted/30 bg-card p-6",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/10 to-transparent animate-[shimmer_1.6s_infinite]"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-5 w-40 bg-muted rounded mb-4"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf space-y-3",children:[0,1,2,3].map(e=>(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf flex items-center gap-3",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-8 w-8 rounded-full bg-muted"}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf space-y-2 w-full",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-3 w-28 bg-muted rounded"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-3 w-40 bg-muted/80 rounded"})]})]},e))})]}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf relative overflow-hidden rounded-xl border border-muted/30 bg-card p-6",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/10 to-transparent animate-[shimmer_1.6s_infinite]"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-5 w-48 bg-muted rounded mb-4"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf space-y-3",children:[0,1,2].map(e=>(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf flex items-center justify-between p-3 rounded-lg border bg-muted/20",children:[(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf flex items-center gap-3",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-8 w-8 rounded-full bg-muted"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-4 w-32 bg-muted rounded"})]}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf h-4 w-16 bg-muted rounded"})]},e))})]})]}),(0,a.jsxs)("div",{className:"jsx-45d27ee17459fedf relative overflow-hidden rounded-xl border border-muted/30 bg-card p-8 text-center",children:[(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/10 to-transparent animate-[shimmer_1.6s_infinite]"}),(0,a.jsx)("div",{className:"jsx-45d27ee17459fedf mx-auto h-10 w-40 bg-muted rounded"})]})]}),(0,a.jsx)(l(),{id:"45d27ee17459fedf",children:"@-webkit-keyframes shimmer{100%{-webkit-transform:translatex(100%);transform:translatex(100%)}}@-moz-keyframes shimmer{100%{-moz-transform:translatex(100%);transform:translatex(100%)}}@-o-keyframes shimmer{100%{-o-transform:translatex(100%);transform:translatex(100%)}}@keyframes shimmer{100%{-webkit-transform:translatex(100%);-moz-transform:translatex(100%);-o-transform:translatex(100%);transform:translatex(100%)}}"})]}):Q?O||eR||!E||eD?(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)(i.$,{onClick:()=>r.push("/arena"),variant:"outline",className:"flex items-center gap-2",children:[(0,a.jsx)(T,{className:"h-4 w-4"}),"Back to Arena"]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold",children:["Lobby #",eI]}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:[Q.status," (",eU(eS),")"]}),eM&&(0,a.jsxs)(d.E,{className:"mt-2 bg-blue-100 text-blue-800 border-blue-300",children:[(0,a.jsx)(_.A,{className:"h-3 w-3 mr-1"}),"Viewing Results"]}),eQ&&!G&&(0,a.jsxs)(d.E,{className:"mt-2 bg-green-100 text-green-800 border-green-300",children:[(0,a.jsx)(I.A,{className:"h-3 w-3 mr-1"}),"Open to Everyone"]})]})]}),(0,a.jsxs)(c.Zp,{className:"mb-8",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(c.ZB,{className:"flex items-center gap-3",children:[(s=Q.mode).includes("Duel")?(0,a.jsx)(k.A,{className:"h-6 w-6"}):s.includes("Royale")?(0,a.jsx)(C.A,{className:"h-6 w-6"}):s.includes("Quick")?(0,a.jsx)(z.A,{className:"h-6 w-6"}):s.includes("Championship")?(0,a.jsx)(_.A,{className:"h-6 w-6"}):(0,a.jsx)(L,{className:"h-6 w-6"}),Q.mode]}),!J&&!em&&(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(d.E,{variant:"default",className:"bg-green-100 text-green-800 border-green-300",children:[(0,a.jsx)(z.A,{className:"h-3 w-3 mr-1"}),"Synchronized"]})})]})}),(0,a.jsxs)(c.Wu,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(P.A,{className:"h-5 w-5 text-yellow-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Entry Fee"}),(0,a.jsxs)("p",{className:"font-semibold",children:[Q.entryFee," CFX"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(I.A,{className:"h-5 w-5 text-blue-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Players"}),(0,a.jsxs)("p",{className:"font-semibold",children:[Q.currentPlayers,"/",Q.maxPlayers]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(_.A,{className:"h-5 w-5 text-purple-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Prize Pool"}),(0,a.jsxs)("p",{className:"font-semibold",children:[(Number.parseFloat(Q.entryFee)*Q.maxPlayers).toFixed(1)," CFX"]})]})]})]}),(es||3===eS)&&eu&&(0,a.jsx)("div",{className:"mt-6 p-6 bg-gradient-to-r from-yellow-100 to-orange-100 border-2 border-yellow-300 rounded-xl shadow-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center shadow-md",children:(0,a.jsx)(C.A,{className:"h-7 w-7 text-white"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-yellow-800 mb-1 winner-text",children:"\uD83C\uDFC6 Winner"}),(0,a.jsxs)("p",{className:"font-bold text-xl text-black mb-1 winner-text",children:[eu.slice(0,6),"...",eu.slice(-4)]}),(0,a.jsxs)("p",{className:"text-sm font-semibold text-orange-700 px-3 py-1 rounded-full inline-block winner-prize",children:["Prize: ",(Number.parseFloat(Q.entryFee)*Q.maxPlayers).toFixed(1)," CFX"]})]})]})})]})]}),(0,a.jsxs)(c.Zp,{className:"mb-8",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"h-5 w-5"}),"Lobby Details"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(L,{className:"h-4 w-4 text-gray-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,a.jsx)("p",{className:"font-semibold",children:eU(eS)})]})]}),null!==el&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(D.A,{className:"h-4 w-4 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Created"}),(0,a.jsxs)("p",{className:"font-semibold",children:[new Date(1e3*el).toLocaleString()," ",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",eW(el,!1),")"]})]}),1===eS&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Timer reset when lobby became FULL"})]})]}),null!==eo&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(D.A,{className:"h-4 w-4 text-orange-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Expires"}),(0,a.jsxs)("p",{className:"font-semibold",children:[new Date(1e3*eo).toLocaleString()," ",(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",eW(eo,!0),")"]})]})]})]}),null!==ec&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(D.A,{className:"h-4 w-4 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Timeout Window"}),(0,a.jsxs)("p",{className:"font-semibold",children:[Math.floor(ec/60)," minutes"]})]})]}),null!==K&&!es&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(D.A,{className:"h-4 w-4 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Time Remaining"}),(0,a.jsxs)("p",{className:"font-semibold text-green-600",children:[Math.floor((K||0)/60),"m ",(K||0)%60,"s"]})]})]}),(null==Q?void 0:Q.creator)&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(F,{className:"h-4 w-4 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Creator"}),(0,a.jsxs)("p",{className:"font-semibold",children:[Q.creator.slice(0,6),"...",Q.creator.slice(-4)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(R.A,{className:"h-4 w-4 text-emerald-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Prize Distributed (on-chain)"}),(0,a.jsx)("p",{className:"font-semibold",children:3===eS?"Yes":"No"})]})]})]})})]}),em&&(0,a.jsx)(c.Zp,{className:"mb-8 border-green-200 bg-green-50",children:(0,a.jsx)(c.Wu,{className:"p-6 text-center",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"text-6xl",children:"\uD83C\uDFC1"}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-green-700",children:"Game Over!"}),(0,a.jsx)("p",{className:"text-lg text-green-600",children:"The quiz battle has ended. Check the leaderboard below for final results."})]})})}),(!J||em||eM)&&(0,a.jsx)(Y,{lobbyId:eI,refreshInterval:3e3,gameState:em?"finished":"waiting",currentPlayerAddress:E||void 0},"scores-".concat(em?"finished":"waiting")),(null==Q?void 0:Q.creator)&&E&&(null==Q?void 0:null===(e=Q.creator)||void 0===e?void 0:e.toLowerCase())===E.toLowerCase()&&em&&(0,a.jsx)(c.Zp,{className:"mb-8",children:(0,a.jsx)(c.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,a.jsx)(_.A,{className:"h-8 w-8 text-yellow-500"}),(0,a.jsx)("h3",{className:"text-xl font-semibold",children:3===eS?"Prize Pool Distributed":"Resolve Prize Pool"})]}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:3===eS?"The prize pool has been successfully distributed to the winner.":"As the lobby creator, you can resolve the prize pool and distribute it to the winner."}),3!==eS?(0,a.jsx)(i.$,{onClick:eZ,disabled:e_,className:"bg-purple-600 hover:bg-purple-700 text-white",children:e_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Resolving Prize..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.A,{className:"mr-2 h-4 w-4"}),"Resolve Prize (Creator)"]})}):(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 text-green-600 font-semibold",children:[(0,a.jsx)(R.A,{className:"h-5 w-5"}),"Completed"]})]})})}),(()=>{let e=J&&!es&&!em&&Q;return console.log("Quiz rendering check:",{gameStarted:J,isExpired:es,gameFinished:em,lobby:!!Q,shouldShowQuiz:e}),e})()&&(0,a.jsx)($,{lobbyId:eI,players:U,category:Q.category,questionDurationSec:10,seed:"".concat(A.QX.QUIZ_CRAFT_ARENA,"-").concat(eP,"-").concat(el||0),currentPlayerAddress:E||U.find(e=>e)||"",onGameEnd:e=>{H(e),ex(!0),X(!1);try{sessionStorage.setItem("quizcraft:finished:".concat(eI),"true")}catch(e){}eh(e.reduce((e,s)=>e.score>s.score?e:s).player),m({title:"\uD83C\uDFC1 Game Finished!",description:"Check the leaderboard below for final results!",duration:5e3}),console.log("Synchronized game ended with results:",e)},onScoreUpdate:e=>{H(Object.entries(e).map(e=>{let[s,t]=e;return{player:s,score:t,correctAnswers:Math.floor((t||0)/100),totalQuestions:10,timeBonus:Math.floor((t||0)%100)}}))}}),(0,a.jsxs)(c.Zp,{className:"mb-8",children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(I.A,{className:"h-5 w-5"}),"Players (",Q.currentPlayers,"/",Q.maxPlayers,")"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)("div",{className:"space-y-3",children:U.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border ".concat(e.toLowerCase()===(null==E?void 0:E.toLowerCase())?"bg-green-50 border-green-200":"bg-muted/20"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:s+1}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.toLowerCase()===(null==E?void 0:E.toLowerCase())?"You":"".concat(e.slice(0,6),"...").concat(e.slice(-4))}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e})]})]}),e.toLowerCase()===(null==E?void 0:E.toLowerCase())&&(0,a.jsxs)(d.E,{variant:"default",className:"bg-green-500",children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1"}),"You"]})]},"".concat(e,"-").concat(s)))})})]})]})}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto text-center",children:(0,a.jsx)(c.Zp,{className:"border-2 border-yellow-500/20 bg-yellow-900/10",children:(0,a.jsxs)(c.Wu,{className:"py-16",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-yellow-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(L,{className:"h-10 w-10 text-yellow-500"})}),(0,a.jsx)("h2",{className:"font-montserrat font-bold text-3xl mb-4 text-yellow-400",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-xl text-muted-foreground mb-4",children:"You are not a member of this lobby. Please join the lobby from the arena first."}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-8",children:"Note: Expired or completed lobbies are open to anyone for viewing results."}),(0,a.jsxs)(i.$,{onClick:()=>r.push("/arena"),size:"lg",className:"bg-yellow-600 hover:bg-yellow-700 text-white font-semibold",children:[(0,a.jsx)(T,{className:"mr-3 h-5 w-5"}),"Back to Arena"]})]})})})}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto text-center",children:(0,a.jsx)(c.Zp,{className:"border-2 border-red-500/20 bg-red-900/10",children:(0,a.jsxs)(c.Wu,{className:"py-16",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-red-500/20 rounded-2xl flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(L,{className:"h-10 w-10 text-red-500"})}),(0,a.jsx)("h2",{className:"font-montserrat font-bold text-3xl mb-4 text-red-400",children:"Lobby Not Found"}),(0,a.jsx)("p",{className:"text-xl text-muted-foreground mb-8",children:"The lobby you're looking for doesn't exist or you don't have access to it."}),(0,a.jsxs)(i.$,{onClick:()=>r.push("/arena"),size:"lg",className:"bg-red-600 hover:bg-red-700 text-white font-semibold",children:[(0,a.jsx)(T,{className:"mr-3 h-5 w-5"}),"Back to Arena"]})]})})})})}t(9509)},646:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1539:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},4186:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5595:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]])},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})},6785:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},7168:(e,s,t)=>{"use strict";t.d(s,{$:()=>i});var a=t(5155);t(2115);var r=t(9708),l=t(2085),n=t(3999);let o=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:s,variant:t,size:l,asChild:i=!1,...c}=e,d=i?r.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,n.cn)(o({variant:t,size:l,className:s})),...c})}},8564:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},9037:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[95,973,675,367,441,684,358],()=>s(395)),_N_E=e.O()}]);