"use strict";(()=>{var e={};e.id=98,e.ids=[98],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{e.exports=require("punycode")},27910:e=>{e.exports=require("stream")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},41506:(e,r,o)=>{o.d(r,{N:()=>s});let s=(0,o(83008).UU)("https://xngitbhfnrgjiegsxnat.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhuZ2l0YmhmbnJnamllZ3N4bmF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1OTYwNzUsImV4cCI6MjA3MzE3MjA3NX0.hk1mvT6Y0iKXkNV9gphVqoECtZcpHHHTSyGouzTa-JE")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45281:(e,r,o)=>{o.r(r),o.d(r,{patchFetch:()=>f,routeModule:()=>y,serverHooks:()=>b,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>h});var s={};o.r(s),o.d(s,{GET:()=>g});var t=o(96559),l=o(48088),a=o(37719),n=o(32190),i=o(41506),p=o(76803),c=o(42376),u=o(77601),d=o(33599);async function g(e){try{let{searchParams:r}=new URL(e.url),o=Number(r.get("lobbyId"));if(console.log("API Request - lobbyId:",o,"type:",typeof o),!o||isNaN(o))return console.error("Invalid lobbyId:",o),n.NextResponse.json({error:"Missing or invalid lobbyId"},{status:400});let s=[];try{console.log("Attempting to fetch players from contract for lobbyId:",o);let e=new p.FR(d.qQ.rpcUrl),r=new c.NZ(u.QX.QUIZ_CRAFT_ARENA,u.UN,e);s=await r.getPlayersInLobby(o),console.log("Players from contract:",s)}catch(e){console.error("Error fetching players from contract:",e),console.log("Contract call failed, will try to get players from game results instead")}console.log("Fetching games from Supabase for lobbyId:",o);let{data:t,error:l}=await i.N.from("games").select("id").eq("lobby_id",o),a=[];if(l?console.error("Error fetching games from Supabase:",l):console.log("Games found:",t),!l&&t&&t.length>0){let e=t.map(e=>e.id);console.log("Game IDs for lobby:",e);let{data:r,error:o}=await i.N.from("game_results").select("*").in("game_id",e).order("score",{ascending:!1});!o&&r?(a=r||[],console.log("All game results for lobby:",a)):console.error("Error fetching game results:",o)}else console.log("No games found for lobby:",o,l);0===s.length&&a.length>0&&(s=[...new Set(a.map(e=>e.player_address))],console.log("Got players from game results:",s));let g=s.map(e=>{let r=e.toLowerCase(),o=a.filter(e=>(e.player_address||"").toLowerCase()===r),s=o.reduce((e,r)=>r.score>e.score?r:e,o[0]||null);return console.log(`Player ${e}: ${o.length} results found`,o),{player_address:e,score:s?.score||0,correct_answers:s?.correct_answers||0,total_questions:s?.total_questions||0,time_bonus:s?.time_bonus||0,has_played:!!s}});console.log("Combined players with scores:",g);let y=null;if(g.length>0){let e=g.filter(e=>e.has_played);if(e.length>0){let r=e.reduce((e,r)=>e.score>r.score?e:r);y=r.player_address,console.log("Winner determined:",y,"with score:",r.score)}}return console.log("Returning API response:",{playersCount:g.length,winner:y,totalPlayers:s.length,playersWithScores:a.length}),n.NextResponse.json({players:g,winner:y,totalPlayers:s.length,playersWithScores:a.length,debug:{lobbyId:o,playersFromContract:s,allGameResults:a,finalCombined:g,winner:y}})}catch(e){return console.error("all-players error",e),n.NextResponse.json({error:"Unexpected error",details:e.message},{status:500})}}let y=new t.AppRouteRouteModule({definition:{kind:l.RouteKind.APP_ROUTE,page:"/api/scores/all-players/route",pathname:"/api/scores/all-players",filename:"route",bundlePath:"app/api/scores/all-players/route"},resolvedPagePath:"/Users/vikashyadav/Developer/AllgitFiles/QuizCraft/Frontend/app/api/scores/all-players/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:h,serverHooks:b}=y;function f(){return(0,a.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:h})}},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{e.exports=require("zlib")},77598:e=>{e.exports=require("node:crypto")},79551:e=>{e.exports=require("url")},81630:e=>{e.exports=require("http")}};var r=require("../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),s=r.X(0,[828,580,8,803,829],()=>o(45281));module.exports=s})();